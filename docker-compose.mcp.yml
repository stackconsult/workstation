# Docker Compose for All 20 MCP Containers
# Each agent gets its own dedicated MCP server container

version: '3.8'

services:
  # Agent 01: CSS Selector Builder MCP
  mcp-01-selector:
    build: ./mcp-containers/01-selector-mcp
    container_name: mcp-selector
    ports:
      - "3001:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=selector-builder
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Agent 02: Navigation MCP
  mcp-02-navigation:
    build: ./mcp-containers/02-navigation-mcp
    container_name: mcp-navigation
    ports:
      - "3002:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=navigation-helper
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Agent 03: Data Extraction MCP
  mcp-03-extraction:
    build: ./mcp-containers/03-extraction-mcp
    container_name: mcp-extraction
    ports:
      - "3003:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=data-extractor
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Agent 04: Error Handling MCP
  mcp-04-error:
    build: ./mcp-containers/04-error-handling-mcp
    container_name: mcp-error
    ports:
      - "3004:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=error-handler
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Agent 05: Workflow MCP
  mcp-05-workflow:
    build: ./mcp-containers/05-workflow-mcp
    container_name: mcp-workflow
    ports:
      - "3005:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=workflow-orchestrator
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Agent 06: Project Builder MCP
  mcp-06-builder:
    build: ./mcp-containers/06-project-builder-mcp
    container_name: mcp-builder
    ports:
      - "3006:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=project-builder
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Agent 07: Code Quality MCP
  mcp-07-quality:
    build: ./mcp-containers/07-code-quality-mcp
    container_name: mcp-quality
    ports:
      - "3007:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=code-quality
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Agent 08: Performance MCP
  mcp-08-performance:
    build: ./mcp-containers/08-performance-mcp
    container_name: mcp-performance
    ports:
      - "3008:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=performance-monitor
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Agent 09: Error Tracker MCP
  mcp-09-tracker:
    build: ./mcp-containers/09-error-tracker-mcp
    container_name: mcp-tracker
    ports:
      - "3009:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=error-tracker
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Agent 10: Security MCP
  mcp-10-security:
    build: ./mcp-containers/10-security-mcp
    container_name: mcp-security
    ports:
      - "3010:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=security-scanner
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Agent 11: Accessibility MCP
  mcp-11-a11y:
    build: ./mcp-containers/11-accessibility-mcp
    container_name: mcp-a11y
    ports:
      - "3011:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=accessibility-checker
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Agent 12: Integration MCP
  mcp-12-integration:
    build: ./mcp-containers/12-integration-mcp
    container_name: mcp-integration
    ports:
      - "3012:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=integration-hub
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Agent 13: Docs Auditor MCP
  mcp-13-docs:
    build: ./mcp-containers/13-docs-auditor-mcp
    container_name: mcp-docs
    ports:
      - "3013:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=docs-auditor
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Agent 14: Advanced Automation MCP
  mcp-14-automation:
    build: ./mcp-containers/14-advanced-automation-mcp
    container_name: mcp-automation
    ports:
      - "3014:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=advanced-automation
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Agent 15: API Integration MCP
  mcp-15-api:
    build: ./mcp-containers/15-api-integration-mcp
    container_name: mcp-api
    ports:
      - "3015:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=api-integrator
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Agent 16: Data Processing MCP
  mcp-16-data:
    build: ./mcp-containers/16-data-processing-mcp
    container_name: mcp-data
    ports:
      - "3016:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=data-processor
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Agent 17: Learning Platform MCP
  mcp-17-learning:
    build: ./mcp-containers/17-learning-platform-mcp
    container_name: mcp-learning
    ports:
      - "3017:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=learning-platform
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Agent 18: Community Hub MCP
  mcp-18-community:
    build: ./mcp-containers/18-community-hub-mcp
    container_name: mcp-community
    ports:
      - "3018:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=community-hub
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Agent 19: Deployment MCP
  mcp-19-deploy:
    build: ./mcp-containers/19-deployment-mcp
    container_name: mcp-deploy
    ports:
      - "3019:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=deployment-manager
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Agent 20: Orchestrator MCP (Master)
  mcp-20-orchestrator:
    build: ./mcp-containers/20-orchestrator-mcp
    container_name: mcp-orchestrator
    ports:
      - "3020:3000"
    environment:
      - NODE_ENV=production
      - MCP_SERVER_NAME=master-orchestrator
    depends_on:
      - mcp-01-selector
      - mcp-02-navigation
      - mcp-03-extraction
      - mcp-04-error
      - mcp-05-workflow
      - mcp-06-builder
      - mcp-07-quality
      - mcp-08-performance
      - mcp-09-tracker
      - mcp-10-security
      - mcp-11-a11y
      - mcp-12-integration
      - mcp-13-docs
      - mcp-14-automation
      - mcp-15-api
      - mcp-16-data
      - mcp-17-learning
      - mcp-18-community
      - mcp-19-deploy
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s

  # Nginx reverse proxy for all MCPs
  nginx-proxy:
    image: nginx:alpine
    container_name: mcp-proxy
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - mcp-20-orchestrator
    restart: unless-stopped

networks:
  default:
    name: workstation-mcp-network
