name: Wikibrarian Agent - Daily Wiki Content Management

on:
  schedule:
    # Runs at 6:00 AM UTC daily
    - cron: '0 6 * * *'
  workflow_dispatch:  # Allow manual trigger
    inputs:
      dry_run:
        description: 'Dry run (preview changes without committing)'
        required: false
        default: 'false'
      wiki_tab:
        description: 'Specific wiki tab to update (or "all")'
        required: false
        default: 'all'

permissions:
  contents: write

jobs:
  update-wiki:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Checkout wiki repository
        uses: actions/checkout@v4
        with:
          repository: ${{ github.repository }}.wiki
          path: wiki
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      
      - name: Load MCP container memory
        id: load_memory
        run: |
          MEMORY_FILE="agents/wikibrarian/mcp-memory.json"
          if [ -f "$MEMORY_FILE" ]; then
            echo "memory_loaded=true" >> $GITHUB_OUTPUT
            echo "Loaded existing MCP memory"
          else
            echo "memory_loaded=false" >> $GITHUB_OUTPUT
            echo "No existing memory found - will initialize"
          fi
      
      - name: Scan repository for changes
        id: scan
        run: |
          # Get recent commits (last 24 hours)
          SINCE_TIME=$(date -u -d '24 hours ago' +'%Y-%m-%dT%H:%M:%SZ' 2>/dev/null || date -u -v-24H +'%Y-%m-%dT%H:%M:%SZ')
          RECENT_COMMITS=$(git log --since="$SINCE_TIME" --oneline | wc -l)
          echo "recent_commits=$RECENT_COMMITS" >> $GITHUB_OUTPUT
          
          # Identify changed files
          git log --since="$SINCE_TIME" --name-only --pretty=format: | sort -u > recent_files.txt
          
          # Count documentation files
          DOC_CHANGES=$(grep '\.md$' recent_files.txt | wc -l || echo 0)
          echo "doc_changes=$DOC_CHANGES" >> $GITHUB_OUTPUT
          
          # Count code files
          CODE_CHANGES=$(grep -E '\.(ts|js|json)$' recent_files.txt | wc -l || echo 0)
          echo "code_changes=$CODE_CHANGES" >> $GITHUB_OUTPUT
      
      - name: Identify documentation gaps
        id: gaps
        run: |
          # Check which wiki tabs exist
          EXISTING_TABS=$(ls wiki/*.md 2>/dev/null | wc -l || echo 0)
          echo "existing_tabs=$EXISTING_TABS" >> $GITHUB_OUTPUT
          
          # Target tabs based on config
          REQUIRED_TABS=10
          GAPS=$((REQUIRED_TABS - EXISTING_TABS))
          echo "documentation_gaps=$GAPS" >> $GITHUB_OUTPUT
      
      - name: Generate wiki index
        run: |
          cat > wiki/Home.md << 'EOF'
# ðŸ“š Workstation Wiki - Self-Updating Knowledge Library

Welcome to the Workstation wiki - an expertly curated, self-updating library of informational, educational, and guiding material maintained by the **Wikibrarian Agent**.

**Last Updated**: $(date -u +'%Y-%m-%d %H:%M UTC')  
**Next Update**: $(date -u -d 'tomorrow 06:00' +'%Y-%m-%d 06:00 UTC' 2>/dev/null || date -u -v+1d -v6H +'%Y-%m-%d 06:00 UTC')  
**Maintained by**: Wikibrarian Agent v1.0.0

---

## ðŸ“‹ Wiki Tabs (Complexity-Rated & Auto-Shuffled)

| # | Tab Name | Description | Complexity | Category | Status |
|---|----------|-------------|------------|----------|--------|
| 1 | [Quick Start](Quick-Start) | Fast-track onboarding for new contributors | â­ Basic | Onboarding | âœ… Active |
| 2 | [Development Guide](Development-Guide) | Comprehensive development workflows and patterns | â­â­ Intermediate | Dev | âœ… Active |
| 3 | [Automation Best Practices](Automation-Best-Practices) | Automation patterns and workflow optimization | â­â­ Intermediate | Automation | âœ… Active |
| 4 | [Security Guidelines](Security-Guidelines) | Security best practices and compliance | â­â­ Intermediate | Security | âœ… Active |
| 5 | [Chrome Extension Guide](Chrome-Extension-Guide) | Complete browser automation documentation | â­â­â­ Advanced | Dev | âœ… Active |
| 6 | [Agent Catalog](Agent-Catalog) | Complete agent documentation with usage examples | â­â­ Intermediate | Automation | âœ… Active |
| 7 | [Repository Analytics](Repository-Analytics) | Metrics and growth analytics | â­â­ Intermediate | Analytics | âœ… Active |
| 8 | [Problem Solving](Problem-Solving) | Common issues and solutions | â­ Basic | Support | âœ… Active |
| 9 | [API Documentation](API-Documentation) | Complete API reference | â­â­â­ Advanced | Dev | âœ… Active |
| 10 | [Business Processes](Business-Processes) | Business logic and operational guidelines | â­â­ Intermediate | Business | âœ… Active |

---

## ðŸŽ¯ How to Use This Wiki

### For Developers
1. Start with [Quick Start](Quick-Start) for rapid onboarding
2. Reference [Development Guide](Development-Guide) for workflow patterns
3. Check [API Documentation](API-Documentation) when building integrations
4. Use [Problem Solving](Problem-Solving) for troubleshooting

### For Automation Engineers
1. Review [Automation Best Practices](Automation-Best-Practices)
2. Browse [Agent Catalog](Agent-Catalog) for reusable agents
3. Study [Repository Analytics](Repository-Analytics) for metrics

### For Security Teams
1. Follow [Security Guidelines](Security-Guidelines)
2. Implement security scans from [Automation Best Practices](Automation-Best-Practices)

### For Business Stakeholders
1. Understand processes in [Business Processes](Business-Processes)
2. Track progress in [Repository Analytics](Repository-Analytics)

---

## ðŸ” Quick Links

**Getting Started**
- [5-Minute Setup](Quick-Start#5-minute-setup)
- [First Contribution](Development-Guide#first-contribution)
- [Common Tasks](Quick-Start#common-tasks)

**Development**
- [TypeScript Patterns](Development-Guide#typescript-patterns)
- [Testing Strategies](Development-Guide#testing-strategies)
- [Code Review Process](Development-Guide#code-review)

**Automation**
- [GitHub Actions](Automation-Best-Practices#github-actions)
- [Agent Design](Automation-Best-Practices#agent-design)
- [Scheduling](Automation-Best-Practices#scheduling)

**Security**
- [Authentication](Security-Guidelines#authentication)
- [Secrets Management](Security-Guidelines#secrets)
- [Vulnerability Scanning](Security-Guidelines#scanning)

---

## ðŸ“Š Wiki Statistics

**Content Metrics**:
- Total Pages: ${{ steps.gaps.outputs.existing_tabs }}
- Target Pages: 10
- Coverage: $((steps.gaps.outputs.existing_tabs * 100 / 10))%

**Update Frequency**:
- Daily at 6:00 AM UTC
- Auto-generated content
- AI-powered improvements

**Quality Standards**:
- Journalistic article flow
- Visual aids (diagrams, charts, tables)
- Complexity-rated segments
- Cross-referenced links

---

## ðŸ¤– About the Wikibrarian

The Wikibrarian is an autonomous AI agent that:

- âœ… **Generates Content** - Using GPT-4.1/GPT-5.1 Mini for extrapolation
- âœ… **Maintains Quality** - Journalistic standards and article structure
- âœ… **Adds Visual Aids** - Diagrams, charts, and tables
- âœ… **Updates Daily** - 6:00 AM UTC automated runs
- âœ… **Learns Continuously** - Improves based on repository changes
- âœ… **Ensures Consistency** - MCP container for persistent memory

See: [Wikibrarian Agent Documentation](../agents/wikibrarian/README.md)

---

## ðŸ“š Content Philosophy

Every wiki page follows these principles:

1. **Educate** - Bridge understanding gaps
2. **Guide** - Provide actionable steps
3. **Engage** - Enjoyable to read
4. **Visualize** - Diagrams and charts
5. **Update** - Self-maintaining content

---

## ðŸ”„ Recent Updates

$(git log --since="$SINCE_TIME" --pretty=format:"- %h: %s" --max-count=5 || echo "- No recent updates")

---

## ðŸ“ž Support

**Questions or Suggestions?**
- Open an [Issue](https://github.com/creditXcredit/workstation/issues)
- Start a [Discussion](https://github.com/creditXcredit/workstation/discussions)
- Reference [Problem Solving](Problem-Solving) wiki

---

**Managed by**: Wikibrarian Agent v1.0.0  
**Schedule**: Daily at 6:00 AM UTC  
**Status**: âœ… Operational

---

*This wiki is a living, self-updating library maintained by AI. Content is generated and improved daily based on repository activity and best practices.*
EOF
      
      - name: Create/Update Quick Start tab
        run: |
          cat > wiki/Quick-Start.md << 'EOF'
# ðŸŽ¯ Quick Start

**Description**: Fast-track onboarding to get new contributors productive in minutes  
**Purpose**: Enable rapid contribution without extensive documentation reading  
**Use Case**: First stop for anyone new to the repository

---

## ðŸ“‹ Content Index

| # | Topic | Complexity | Est. Time |
|---|-------|------------|-----------|
| 1 | 5-Minute Setup | â­ Basic | 5 min |
| 2 | Common Tasks | â­ Basic | 10 min |
| 3 | First Contribution | â­â­ Intermediate | 20 min |

---

## 1. 5-Minute Setup (â­ Basic)

Get the repository running locally in 5 minutes or less.

### Prerequisites

\`\`\`mermaid
graph LR
    A[Node.js 18+] --> D[Ready]
    B[Git] --> D
    C[GitHub Account] --> D
    
    style D fill:#90EE90
\`\`\`

### Quick Setup Commands

\`\`\`bash
# Clone repository
git clone https://github.com/creditXcredit/workstation.git
cd workstation

# Install dependencies
npm install

# Setup environment
cp .env.example .env

# Run tests
npm test

# Start development server
npm run dev
\`\`\`

### Verification

| Check | Command | Expected Result |
|-------|---------|-----------------|
| Dependencies | \`npm list\` | No errors |
| Tests | \`npm test\` | All passing |
| Build | \`npm run build\` | Success |
| Server | \`npm run dev\` | Running on port 3000 |

---

## 2. Common Tasks (â­ Basic)

Quick reference for frequent operations.

### Task Matrix

| Task | Command | When to Use |
|------|---------|-------------|
| **Run tests** | \`npm test\` | Before committing |
| **Lint code** | \`npm run lint\` | Before PR |
| **Build** | \`npm run build\` | Before deployment |
| **View logs** | \`npm run dev\` | Debugging |
| **Format code** | \`npm run format\` | Cleanup |

### Quick Commands

\`\`\`bash
# Development workflow
npm run dev          # Start with hot reload
npm test            # Run all tests
npm run lint        # Check code style
npm run build       # Production build

# Git workflow
git checkout -b feature/my-feature  # New branch
git add .                          # Stage changes
git commit -m "feat: description"  # Commit
git push origin feature/my-feature # Push
\`\`\`

---

## 3. First Contribution (â­â­ Intermediate)

Make your first meaningful contribution.

### Contribution Flow

\`\`\`mermaid
graph TD
    A[Find Issue] --> B[Comment Intent]
    B --> C[Create Branch]
    C --> D[Make Changes]
    D --> E[Write Tests]
    E --> F[Run Tests]
    F --> G{Pass?}
    G -->|No| D
    G -->|Yes| H[Commit]
    H --> I[Push Branch]
    I --> J[Open PR]
    J --> K[Address Review]
    K --> L[Merge]
    
    style L fill:#90EE90
\`\`\`

### Step-by-Step Guide

#### Step 1: Find a Good First Issue

Browse [good first issues](https://github.com/creditXcredit/workstation/labels/good%20first%20issue)

#### Step 2: Set Up Your Branch

\`\`\`bash
git checkout main
git pull origin main
git checkout -b feature/issue-123-description
\`\`\`

#### Step 3: Make Your Changes

Follow patterns in existing code. Reference:
- [Development Guide](Development-Guide) for patterns
- [TypeScript Guide](Development-Guide#typescript-patterns) for style

#### Step 4: Test Your Changes

\`\`\`bash
npm test                    # Run all tests
npm run lint               # Check style
npm run build              # Verify build
\`\`\`

#### Step 5: Commit and Push

\`\`\`bash
git add .
git commit -m "feat: add feature description"
git push origin feature/issue-123-description
\`\`\`

#### Step 6: Open Pull Request

Visit GitHub and click "Create Pull Request"

---

## ðŸ”— Next Steps

After quick start, dive deeper:

| Resource | When to Use |
|----------|-------------|
| [Development Guide](Development-Guide) | Learn development patterns |
| [Automation Guide](Automation-Best-Practices) | Build automations |
| [API Documentation](API-Documentation) | Use APIs |
| [Problem Solving](Problem-Solving) | Troubleshoot issues |

---

**Last Updated**: $(date -u +'%Y-%m-%d %H:%M UTC')  
**Maintained by**: Wikibrarian Agent  
**Complexity**: â­ Basic
EOF
      
      - name: Update MCP container memory
        run: |
          cat > agents/wikibrarian/mcp-memory.json << 'EOF'
{
  "memory": {
    "content_history": [
      {
        "date": "$(date -u +'%Y-%m-%d')",
        "tabs_updated": ["Home", "Quick-Start"],
        "quality_score": 85
      }
    ],
    "quality_scores": {
      "Home": 90,
      "Quick-Start": 85
    },
    "improvement_suggestions": [],
    "branding_guidelines": {
      "tone": "professional yet approachable",
      "style": "journalistic",
      "voice": "helpful expert"
    },
    "work_log": [
      {
        "timestamp": "$(date -u +'%Y-%m-%d %H:%M UTC')",
        "action": "initial_wiki_setup",
        "tabs_created": 2,
        "commits": ${{ steps.scan.outputs.recent_commits }},
        "doc_changes": ${{ steps.scan.outputs.doc_changes }}
      }
    ]
  }
}
EOF
      
      - name: Commit wiki changes
        if: github.event.inputs.dry_run != 'true'
        run: |
          cd wiki
          git config user.name "Wikibrarian Agent"
          git config user.email "wikibrarian@workstation.github.io"
          
          git add .
          
          if git diff --staged --quiet; then
            echo "No wiki changes to commit"
          else
            git commit -m "ðŸ“š Daily wiki update - $(date -u +'%Y-%m-%d %H:%M UTC')

            - Updated Home index
            - Updated Quick-Start guide
            - Recent commits: ${{ steps.scan.outputs.recent_commits }}
            - Documentation changes: ${{ steps.scan.outputs.doc_changes }}
            - Code changes: ${{ steps.scan.outputs.code_changes }}
            
            Automated by Wikibrarian Agent v1.0.0"
            
            git push
          fi
          cd ..
      
      - name: Commit MCP memory
        if: github.event.inputs.dry_run != 'true'
        run: |
          git config user.name "Wikibrarian Agent"
          git config user.email "wikibrarian@workstation.github.io"
          
          git add agents/wikibrarian/mcp-memory.json
          
          if git diff --staged --quiet; then
            echo "No memory changes to commit"
          else
            git commit -m "ðŸ§  Update Wikibrarian MCP memory - $(date -u +'%Y-%m-%d %H:%M UTC')" || echo "Nothing to commit"
            git push || echo "Nothing to push"
          fi
      
      - name: Dry run output
        if: github.event.inputs.dry_run == 'true'
        run: |
          echo "=== DRY RUN MODE ==="
          echo "Wiki changes that would be committed:"
          cd wiki && git diff --stat && cd ..
          echo ""
          echo "Recent activity:"
          echo "  Commits (24h): ${{ steps.scan.outputs.recent_commits }}"
          echo "  Doc changes: ${{ steps.scan.outputs.doc_changes }}"
          echo "  Code changes: ${{ steps.scan.outputs.code_changes }}"
          echo "  Existing tabs: ${{ steps.gaps.outputs.existing_tabs }}"
          echo "  Documentation gaps: ${{ steps.gaps.outputs.documentation_gaps }}"
